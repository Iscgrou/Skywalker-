# Bug Fix Report - Invoice Edit Debt Calculation

## ๐จ **ุจุงฺฏ ฺฉุดู ุดุฏู:** ูุญุงุณุจู ูุงุฏุฑุณุช ุจุฏู ุฏุฑ ูุฑุงุด ูุงฺฉุชูุฑูุง

### **ูุดฺฉู:**
ููฺฏุงู ูุฑุงุด ูุงฺฉุชูุฑูุงุ ุณุณุชู **ุงุฎุชูุงู ูุจูุบ ุฑุง ุจู ุจุฏู ุงุถุงูู ูโฺฉุฑุฏ** ุจู ุฌุง **ูุญุงุณุจู ูุฌุฏุฏ** ฺฉู ุจุฏู.

### **ฺฉุฏ ูุดฺฉูโุณุงุฒ:**
```typescript
// ฺฉุฏ ูุฏู (ุจุงฺฏโุฏุงุฑ)
const debtDifference = editData.editedAmount - editData.originalAmount;
await db.update(representatives)
  .set({
    totalDebt: sql`${representatives.totalDebt} + ${debtDifference}`, // โ ุงุดุชุจุงู
    updatedAt: new Date()
  })
```

### **ููุงูุฏูโูุง ุขุณุจโุฏุฏู:**
1. **ุฏุฑุงูุจ (daryamb):** ุจุฏู ทูซณฐณูซฒฐฐ โ **ุงุตูุงุญ ุดุฏ ุจู ณูซตฐฐูซฐฐฐ**
2. **ูุงุฏุฑููุจ (ghadirmob):** ุจุฏู ณูซดฑฑูซตฐฐ โ **ุงุตูุงุญ ุดุฏ ุจู ฒูซธฐฐูซฐฐฐ**  
3. **ุนุงุจุฏูุจ (Abedmb):** ุจุฏู ุตุญุญ ุจูุฏ ฑูซตฐฐูซฐฐฐ โ **ุชุงุฏ ุดุฏ**

---

## โ **ุฑุงูโุญู ูพุงุฏู ุดุฏู:**

### **1. ุงุตูุงุญ ฺฉุฏ:**
```typescript
// ฺฉุฏ ุฌุฏุฏ (ุงุตูุงุญ ุดุฏู)
// FIX: Update representative debt using correct calculation
// Instead of adding difference, recalculate total debt from all invoices
await this.updateRepresentativeFinancials(invoice.representativeId);
```

### **2. ุงุตูุงุญ ุฏุงุฏูโูุง ุขุณุจโุฏุฏู:**
- ูุญุงุณุจู ูุฌุฏุฏ ุจุฏู ุงุฒ ุฑู ูุงฺฉุชูุฑูุง ููุฌูุฏ
- ุจุฑูุฒุฑุณุงู ููุงุฏุฑ ุตุญุญ ุฏุฑ ุฏุชุงุจุณ
- ุซุจุช ูุนุงูุช ุงุตูุงุญ ุฏุฑ activity logs

### **3. ูพุดฺฏุฑ ุงุฒ ุชฺฉุฑุงุฑ:**
- ุญุฐู ููุทู ุงุถุงูู ฺฉุฑุฏู ุงุฎุชูุงู
- ุงุณุชูุงุฏู ุงุฒ ุชุงุจุน `updateRepresentativeFinancials()` 
- ูุญุงุณุจู ูุฌุฏุฏ ฺฉุงูู ุงุฒ ุฑู ูุงฺฉุชูุฑูุง

---

## ๐ **ูุชุงุฌ ุงุตูุงุญ:**

### **ูุจู ุงุฒ ุงุตูุงุญ:**
- ูุฌููุน ูุฑูุด: ฑดฒูซทฐธ ูููู 
- ูุฌููุน ุจุฏู: ฑดนูซณถน ูููู
- **ุงุฎุชูุงู ูุงุตุญุญ:** ถูซถถ ูููู

### **ุจุนุฏ ุงุฒ ุงุตูุงุญ:**
- ูุฌููุน ูุฑูุด: ฑดถูซฑตถ ูููู
- ูุฌููุน ุจุฏู: ฑดถูซฑตถ ูููู  
- **ุงุฎุชูุงู:** ฐ ุชููุงู โ

---

**โ ุจุงฺฏ ฺฉุงููุงู ุจุฑุทุฑู ุดุฏ - ุณุณุชู ูุงู ุตุญุญ ุนูู ูโฺฉูุฏ**

**ุชุงุฑุฎ ุงุตูุงุญ:** ฑดฐด/ฐต/ฑฒ (ฒฐฒต-ฐธ-ฐฑ)
**ูุณุฆูู ุงุตูุงุญ:** ุณุณุชู DA VINCI v6.0